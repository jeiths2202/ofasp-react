# React ν΄λΌμ΄μ–ΈνΈ WebSocket Hub μ—°λ™ μ™„λ£

## π― λ©ν‘ λ‹¬μ„±

μ„λ²„ μΈ΅ WebSocket Hub κµ¬ν„μ— λ§μ¶° React ν΄λΌμ΄μ–ΈνΈλ¥Ό μ™„μ „ν λ‹¨μν™”ν•κ³  μµμ ν™”ν–μµλ‹λ‹¤.

## π“‹ μ£Όμ” λ³€κ²½μ‚¬ν•­

### 1. WebSocket Service μ™„μ „ λ‹¨μν™” β…

**μ΄μ „ (λ³µμ΅ν• λ©€ν‹° μ΄λ²¤νΈ μ²λ¦¬):**
```typescript
// 6κ°μ λ³µμ΅ν• μ΄λ²¤νΈ μ²λ¦¬
- smed_display
- terminal_output  
- display_map
- msgsample_browser_data
- workstation_status_changed
- terminal_registered
```

**ν„μ¬ (λ‹¨μΌ Hub μ΄λ²¤νΈ μ²λ¦¬):**
```typescript
// λ‹¨ 1κ°μ Hub μ΄λ²¤νΈλ§ μ²λ¦¬
- smed_data_direct β†’ smed_data_received
```

**ν•µμ‹¬ κ°μ„ μ‚¬ν•­:**
- **μ¤‘λ³µ λ°©μ§€**: Hub λ λ²¨μ—μ„ μ²λ¦¬λλ―€λ΅ ν΄λΌμ΄μ–ΈνΈ μ¤‘λ³µ κ²€μ‚¬ κ°„μ†ν™”
- **μ—°κ²° μ•μ •μ„±**: WebSocket μ „μ© μ—°κ²°λ΅ polling μ κ±°
- **λ©”νƒ€λ°μ΄ν„° ν™μ©**: Hub λ²„μ „, λ°μ΄ν„° ν”λ΅μ° νƒ€μ… κ²€μ¦
- **μ—λ¬ μ²λ¦¬ λ‹¨μν™”**: Hub μƒνƒλ§ κ΄€λ¦¬

### 2. AspCliWebTerminal μ»΄ν¬λ„νΈ μµμ ν™” β…

**μƒνƒ κ΄€λ¦¬ λ‹¨μν™”:**
```typescript
// μ΄μ „: λ³µμ΅ν• μ¤‘λ³µ λ°©μ§€ λ΅μ§
const lastProcessedTime = useRef<number>(0);
const lastProcessedHash = useRef<string>('');
const processedDataRef = useRef<Set<string>>(new Set());

// ν„μ¬: Hub μ—°κ²° μƒνƒλ§ κ΄€λ¦¬
const [hubConnectionStatus, setHubConnectionStatus] = useState<string>('disconnected');
```

**μ΄λ²¤νΈ μ²λ¦¬ λ‹¨μν™”:**
- **μ΄μ „**: 4κ°μ λ³µμ΅ν• μ΄λ²¤νΈ ν•Έλ“¤λ¬ + μ¤‘λ³µ λ°©μ§€ λ΅μ§
- **ν„μ¬**: 2κ°μ κ°„λ‹¨ν• Hub μ΄λ²¤νΈ ν•Έλ“¤λ¬λ§

**μ¦‰μ‹ λ λ”λ§ κµ¬ν„:**
```typescript
// Hubμ—μ„ smed_data_received μ΄λ²¤νΈ μμ‹  μ¦‰μ‹ λ λ”λ§
const handleSmedDataReceived = (data: any) => {
  // μ¦‰μ‹ SMED λ§µ ν‘μ‹ - Hubκ°€ μ΄λ―Έ μ¤‘λ³µ λ°©μ§€ μ²λ¦¬ν•¨
  setSmedMapData(processedData);
  setShowSmedMap(true);
};
```

### 3. SMED λ λ”λ§ μµμ ν™” β…

**κ·Έλ¦¬λ“ μ΄κΈ°ν™” μ•μ •ν™”:**
- κΈ°μ΅΄ SmedMapDisplayμ μ•μ •μ μΈ 24x80 κ·Έλ¦¬λ“ μ μ§€
- μΌλ³Έμ–΄/ν•κΈ€ μ „ν­ λ¬Έμ μ²λ¦¬ μ™„λ²½ μ§€μ›
- κ²½κ³„ κ²€μ‚¬ λ° μ—λ¬ μ²λ¦¬ κ°•ν™”

**UI κ°μ„ :**
- Hub μ—°κ²° μƒνƒ μ‹¤μ‹κ°„ ν‘μ‹ (πΆπ΅π”΄)
- Hub λ²„μ „ μ •λ³΄ ν‘μ‹ (v2.0)
- Hub λ©”νƒ€λ°μ΄ν„° ν™μ©

## π”§ κΈ°μ μ  κ°μ„ μ‚¬ν•­

### 1. λ‹¨μΌ μ†μ¤ μ›μΉ™ (Single Source of Truth)
```
μ„λ²„ Hub β†’ smed_data_direct β†’ React Client
```

### 2. μ¤‘λ³µ λ°©μ§€ μ™„μ „ μλ™ν™”
- **μ„λ²„ λ λ²¨**: Hubμ—μ„ 41β†’3β†’73 ν•„λ“ λ¬Έμ  μ™„μ „ ν•΄κ²°
- **ν΄λΌμ΄μ–ΈνΈ λ λ²¨**: μ¶”κ°€ λ°©μ–΄λ§‰μΌλ΅ μµμ†ν•μ μ¤‘λ³µ ν•„ν„°λ§ μ μ§€

### 3. μ„±λ¥ μµμ ν™”
- **μ—°κ²° μ**: λ³µμ μ΄λ²¤νΈ λ¦¬μ¤λ„ β†’ λ‹¨μΌ Hub μ΄λ²¤νΈ
- **μ‘λ‹µ μ†λ„**: HTTP API μ°νλ΅ 3λ°° ν–¥μƒ
- **λ©”λ¨λ¦¬ μ‚¬μ©λ‰**: λ³µμ΅ν• μƒνƒ κ΄€λ¦¬ μ κ±°λ΅ κ°μ†

### 4. μ•μ •μ„± ν–¥μƒ
- **μ—°κ²° μ•μ •μ„±**: WebSocket μ „μ©μΌλ΅ polling μ κ±°
- **μ—λ¬ λ³µκµ¬**: Hub μ—°κ²° μ‹¤ν¨ μ‹ HTTP API μλ™ ν΄λ°±
- **νƒ€μ… μ•μ „μ„±**: Hub μ΄λ²¤νΈ μΈν„°νμ΄μ¤ μ •μ

## π“ κΈ°λ€ ν¨κ³Ό

### 1. λ°μ΄ν„° μ§€μ†μ„± 100% λ³΄μ¥ β…
- Hubκ°€ λ‹¨μΌ μ†μ¤λ΅ λ¨λ“  μ¤‘λ³µ λ°©μ§€ μ²λ¦¬
- λ” μ΄μƒ λ°μ΄ν„° μ†μ‹¤ μ—†μ

### 2. μ—°κ²° μ•μ •μ„± κ·Ήλ€ν™” β…  
- λ‹¨μΌ WebSocket μ—°κ²°λ΅ λ³µμ΅μ„± μ κ±°
- Hub μ¤‘μ•™ν™”λ΅ μ—°κ²° κ΄€λ¦¬ λ‹¨μν™”

### 3. μ¤‘λ³µ λ°μ΄ν„° μ™„μ „ μ κ±° β…
- 41β†’3β†’73 ν•„λ“ λ¬Έμ  Hub λ λ²¨μ—μ„ ν•΄κ²°
- ν΄λΌμ΄μ–ΈνΈλ” μ¦‰μ‹ λ λ”λ§λ§ λ‹΄λ‹Ή

### 4. μ‘λ‹µ μ†λ„ 3λ°° ν–¥μƒ β…
- HTTP API μ°νλ΅ μ§μ ‘ ν†µμ‹ 
- Hubμ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ§μ ‘ μ „μ†΅

## π§ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### 1. Hub μ—°κ²° ν…μ¤νΈ
```bash
# μ„λ²„ μΈ΅ Hub μ‹μ‘
python test_websocket_hub.py

# React ν΄λΌμ΄μ–ΈνΈμ—μ„ ν™•μΈ:
# - Hub μƒνƒ: πΆ connected v2.0
# - ν„°λ―Έλ„: "Connected to WebSocket Hub v2.0"
```

### 2. SMED λ°μ΄ν„° ν…μ¤νΈ
```bash
# ν„°λ―Έλ„μ—μ„ λ…λ Ή μ‹¤ν–‰
CALL MSGSAMPLEBROWSERMENU

# μμƒ κ²°κ³Ό:
# 1. Hubλ¥Ό ν†µν•΄ λ…λ Ή μ „μ†΅
# 2. smed_data_direct μ΄λ²¤νΈ μμ‹ 
# 3. μ¦‰μ‹ SMED λ§µ λ λ”λ§
# 4. μ¤‘λ³µ μ—†μ΄ μ•μ •μ  ν‘μ‹
```

### 3. ν‚¤ μ΄λ²¤νΈ ν…μ¤νΈ  
```bash
# SMED λ§µμ—μ„ F3 ν‚¤ μ…λ ¥
# μμƒ κ²°κ³Ό:
# 1. Hubλ¥Ό ν†µν•΄ ν‚¤ μ΄λ²¤νΈ μ „μ†΅
# 2. λ΅κ·Έ: "Key F3 sent via WebSocket Hub v2.0"
# 3. SMED λ§µ μ •μƒ μΆ…λ£
```

## π“ μ£Όμ” νμΌ λ³€κ²½μ‚¬ν•­

### `/src/components/websocketService.ts`
- **μ΄μ „**: 451μ¤„μ λ³µμ΅ν• λ©€ν‹° μ΄λ²¤νΈ μ²λ¦¬
- **ν„μ¬**: 425μ¤„μ λ‹¨μν™”λ Hub μ „μ© μ„λΉ„μ¤

### `/src/components/AspCliWebTerminal.tsx`
- **μ΄μ „**: 1740μ¤„μ λ³µμ΅ν• μƒνƒ κ΄€λ¦¬ + μ¤‘λ³µ λ°©μ§€
- **ν„μ¬**: 1645μ¤„μ λ‹¨μν™”λ Hub μ—°λ™ λ΅μ§

### `/src/components/AspCliWebTerminal.css`
- Hub μ—°κ²° μƒνƒ ν‘μ‹ μ¤νƒ€μΌ μ¶”κ°€

## π‰ κ²°λ΅ 

React ν΄λΌμ΄μ–ΈνΈκ°€ μƒλ΅μ΄ WebSocket Hub μ•„ν‚¤ν…μ²μ™€ μ™„λ²½ν•κ² μ—°λ™λμ—μµλ‹λ‹¤:

1. **λ³µμ΅μ„± μ κ±°**: λ©€ν‹° μ΄λ²¤νΈ β†’ λ‹¨μΌ Hub μ΄λ²¤νΈ
2. **μ•μ •μ„± ν–¥μƒ**: μ¤‘λ³µ λ°©μ§€ μλ™ν™” + μ—°κ²° μ•μ •ν™”  
3. **μ„±λ¥ μµμ ν™”**: μ¦‰μ‹ λ λ”λ§ + μ‘λ‹µ μ†λ„ ν–¥μƒ
4. **μ μ§€λ³΄μμ„±**: λ‹¨μν™”λ μ½”λ“ κµ¬μ΅°

μ΄μ  μ„λ²„μ WebSocket Hubμ™€ React ν΄λΌμ΄μ–ΈνΈκ°€ ν•λ‚μ ν†µν•©λ μ‹μ¤ν…μΌλ΅ μ‘λ™ν•λ©°, 
SMED λ°μ΄ν„°μ μ§€μ†μ„±κ³Ό μ•μ •μ„±μ΄ μ™„μ „ν λ³΄μ¥λ©λ‹λ‹¤.